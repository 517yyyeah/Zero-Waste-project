<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Waste Zero</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="navbar">
        <h1>Waste Zero</h1>
    </div>

    <div class="content">
    <div style="text-align:right; margin-bottom: 10px;">
        <a href="/ranking" class="ranking-button">ν¬μΈνΈ μμ„</a>
    </div>

        <label>μ‚¬μ©μ μ΄λ¦„: <input type="text" id="username"></label>
        <button onclick="login()">λ΅κ·ΈμΈ</button>
        <p id="points">ν„μ¬ ν¬μΈνΈ: 0</p >

        <hr>
        <h2>μ„ νƒ κ°€λ¥ν• μλ£</h2>
        <div id="products" class="product-row">
        {% for p in products %}
        <div class="product-card">
            <img src="{{ url_for('static', filename='images/' + p.μ΄λ―Έμ§€) }}" 
                alt="{{ p.μ΄λ¦„ }}" 
                class="product-img">
            <h3>{{ p.μ΄λ¦„ }}</h3>
            <p>κ°€κ²©: {{ p.κ°€κ²© }}μ›</p >
            <p>μ¬κ³ : <span id="stock-{{ p.id }}">{{ p.μ¬κ³  }}</span></p >
            <label>
                κ²°μ  λ°©μ‹:
                <select id="pay-{{ p.id }}">
                    <option value="ν„κΈ">ν„κΈ</option>
                    <option value="μ‹ μ©μΉ΄λ“">μ‹ μ©μΉ΄λ“</option>
                </select>
            </label>
            <button onclick="buyProduct({{ p.id }})">κµ¬λ§¤</button>
        </div>
        {% endfor %}
        </div>

        <hr>
        <h2>β™» λΉλ³‘ νμ</h2>
        <button onclick="recycleBottle()">λΉλ³‘ νμ +1ν¬μΈνΈ</button>

        <h2>π ν¬μΈνΈλ΅ μλ£ κµν™ (20ν¬μΈνΈλ΅ λ½λ² μ¤νΈ μƒμ 1λ³‘ κµν™ κ°€λ¥)</h2>
        <button onclick="redeemDrink()">μλ£ κµν™</button>

        <p id="message"></p >
    </div>

<script>
// β†“ μ•„λλ” κ·Έλ€λ΅ μ μ§€ (JavaScriptλ” λ²μ—­ν•μ§€ μ•μ•„λ„ λ¨)
let currentUser = '';

function login() {
    const username = document.getElementById('username').value;
    fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username })
    })
    .then(res => res.json())
    .then(data => {
        currentUser = username;
        document.getElementById('points').innerText = 'ν„μ¬ ν¬μΈνΈ: ' + data.points;
    });
}

function buyProduct(id) {
    const payment = document.getElementById(`pay-${id}`).value;
    fetch('/buy', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: currentUser, product_id: id, payment })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById('message').innerText = data.message;
            let stockEl = document.getElementById(`stock-${id}`);
            stockEl.innerText = parseInt(stockEl.innerText) - 1;

            // β… δ½Ώη”¨θ‡ε®δΉ‰εΌΉη—ζη¤Ί
            showPopup("β… κµ¬λ§¤ μ„±κ³µ! μλ£λ¥Ό κΊΌλ‚΄μ£Όμ„Έμ”.");
        } else {
            alert(data.error);
        }
    });
}

function recycleBottle() {
    fetch('/recycle', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: currentUser })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById('points').innerText = 'ν„μ¬ ν¬μΈνΈ: ' + data.points;
        }
    });
}

function redeemDrink() {
    fetch('/redeem', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: currentUser })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById('message').innerText = data.message;
        if (data.success) {
            document.getElementById('points').innerText = 'ν„μ¬ ν¬μΈνΈ: ' + data.points;
            document.getElementById('stock-3').innerText = data.stock;
        }
    });
}
function showPopup(message) {
    const popup = document.getElementById('popup');
    popup.innerText = message;
    popup.style.display = 'block';
    setTimeout(() => {
        popup.style.display = 'none';
    }, 2000);
}
<!-- β… θ‡ε®δΉ‰εΌΉη—ε®Ήε™¨ -->
</script>
<div id="popup" class="popup-box">β… κµ¬λ§¤ μ„±κ³µ! μλ£λ¥Ό κΊΌλ‚΄μ£Όμ„Έμ”.</div>
</body>
</html>